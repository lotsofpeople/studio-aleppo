<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="aleppo-citizen-card.html">

<!--
`aleppo-citizen-grid`


@demo demo/aleppo-citizen-grid.html
-->

<dom-module id="aleppo-citizen-grid">
  <template>
    <style>
      :host {
        display: block;
      }

      [hidden] {
        display: none!important;
      }

      .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-column-gap: 16px;
        grid-row-gap: 16px;
        width: 1280px;
        max-width: 100%;
        margin: auto;
      }

      @media screen and (min-width: 737px) {
        .grid {
          grid-template-columns: 1fr 1fr 1fr;
        }        
      }

      @media screen and (min-width: 1025px) {
        .grid {
          grid-template-columns: 1fr 1fr 1fr 1fr;
          grid-template-rows: 1fr;
        }        
      }

      aleppo-citizen-card {
        display: flex;
        align-items: stretch;
        height: var(--card-height);
      }

      aleppo-citizen-card:hover {
        cursor: pointer;
      }
    </style>

    <section class="grid">
      <template
        is="dom-repeat"
        items="[[citizensData]]"
        as="citizen"
        on-dom-change="_updateCardHeight">
        <aleppo-citizen-card
          citizen-id="[[citizen.id]]"
          citizen-name="[[citizen.name]]"
          quote="[[citizen.quote]]"
          image="[[citizen.portrait_url]]"
          on-tap="_handleTapCitizenCard"
          anonymous="[[showAllCitizensAnonymous]]"
        ></aleppo-citizen-card>
      </template>
    </section>

  </template>

  <script>
    Polymer({

      is: 'aleppo-citizen-grid',

      properties: {

        apiEndpoint: {
          type: String
        },
        
        citizensData: {
          type: Array
        },

        selectedCitizen: {
          type: Object
        },

        showAllCitizensAnonymous: {
          type: Boolean,
          value: false
        }

      },

      observers: [
        '_selectedCitizenChanged(selectedCitizen.*)'
      ],

      ready: function() {
        window.addEventListener('resize', this._updateCardHeight.bind(this));
      },

      _selectedCitizenChanged: function(selectedCitizenChange) {
        console.info('_selectedCitizenChanged', selectedCitizenChange.base);
      },

      _handleTapCitizenCard: function(evt) {
        var citizenData = this._getCitizenDataById(evt.currentTarget.citizenId);
        citizenData.interview = '';
        this.fire('card-tapped', citizenData);
      },

      _getCitizenDataById: function(citizenId) {
        return this.citizensData.filter(function(citizenData) {
          return citizenData.id === citizenId
        })[0] || {};
      },

      _updateCardHeight: function() {
        var cardWidth = this.$$('aleppo-citizen-card').offsetWidth;
        this.customStyle['--card-height'] = cardWidth * 1.43 + 'px';
        this.updateStyles();
      }

    });
  </script>
</dom-module>