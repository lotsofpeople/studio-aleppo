<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-carousel/paper-carousel.html">
<link rel="import" href="../iron-selector/iron-selector.html">

<!--
`aleppo-content-slider`

Example:

    <aleppo-content-slider
      images="[[myImagesArray]]"
    ></aleppo-content-slider>


@demo demo/aleppo-content-slider.html 
-->

<dom-module id="aleppo-content-slider">
  <template>
    <style>
      :host {
        display: block;
        -webkit-tap-highlight-color: transparent;
        --text-base: {
          font-kerning: normal;
          text-rendering: optimizeLegibility;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        };
      }

      section {
        position: relative;
        overflow: hidden;
      }

      section, main {
        width: 100%;
        flex: 1;
        display: flex;
      }

      paper-carousel {
        width: 100%;
        flex: 1;
        display: flex;
      }

      paper-carousel::slotted(.paper-carousel_wrapper) {
        flex: 1;
        display: flex;
        align-items: stretch;
      }

      .slide {
        flex: 1;
        display: flex;
        width: 100%;
        min-height: 100%;
        padding: 0;
        margin: 0;
      }

      .slide img {
        pointer-events: none;
        user-select: none;
        width: 100%;
        min-height: 100%;
        object-fit: contain;
        object-position: 50% 50%;
      }

      footer {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        z-index: 1;
        color: white;
        z-index: 2;
        background-color: -moz-linear-gradient(top, rgba(var(--story-color-main--rgb),0) 0%, rgba(var(--story-color-main--rgb),.8) 100%);
        background: -webkit-linear-gradient(top, rgba(var(--story-color-main--rgb),0) 0%,rgba(var(--story-color-main--rgb),.8) 100%);
        background: linear-gradient(to bottom, rgba(var(--story-color-main--rgb),0) 0%,rgba(var(--story-color-main--rgb),.8) 100%);
        padding: 16px;
        box-sizing: border-box;
        transition: 0.3s background, 0.3s padding-bottom;
      }

      :host([hide-caption]) footer {
        background: transparent;
        padding-bottom: 0;
      }

      .dot {
        width: 12px;
        height: 12px;
        margin-right: 8px;
        padding: 0;
        border-radius: 50%;
        background-color: var(--series-color-support, var(--story-color-support));
        display: inline-block;
        border: 0;
        outline: none;
        box-sizing: border-box;
        box-shadow: 0 1px 6px rgba(var(--story-color-main--rgb),.4);
        cursor: pointer;
      }

      .dot.iron-selected {
        background-color: var(--series-color-highlight, var(--story-color-highlight));
      }

      h6 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        min-height: 21px;
        max-height: 100px;
        overflow: hidden;
        margin: 0;
        padding: 0;
        margin: 8px 0 0 0;
        box-sizing: border-box;
        line-height: 1.2;
        color: var(--series-color-support);
        font-weight: 400;
        @apply --text-base;
        font-family: var(--series-font-body, var(--story-font-body));
        font-size: 16px;
        transition: 0.3s transform ease-out, 0.3s margin ease-out;
      }

      :host([hide-caption]) h6 {
        transform: translateY(32px);
        white-space: nowrap;
        text-overflow: ellipsis;
        margin: 0;
      }

      nav {
        padding: 12px 0;
        margin: 0;
        position: relative;
      }

      nav:before {
        position: absolute;
        width: 100%;
        bottom: 0;
        left: 0;
        height: 1px;
        content: '';
        transition: 0.3s background-color;
        background-color: var(--series-color-highlight, var(--story-color-highlight));
      }

      :host([hide-caption]) nav:before {
        background-color: transparent;
      }
    </style>
    
    <section>
      <main id="main">
        <paper-carousel
          items="1"
          controls="false"
          dots="false"
          dotText="false"
          total-items="{{totalItems}}"
          current-item="{{currentItem}}"
        >
          <template is="dom-repeat" items="[[_objectToArray(images)]]" as="image" restamp="true">
            <figure class="slide">
              <img src$="[[image.src]]">
            </figure>
          </template>
        </paper-carousel>
      </main>
      <footer>
        <nav>
        <iron-selector selected="[[currentItem]]" on-iron-select="_handleSelectDot">
          <template is="dom-repeat" items="[[_objectToArray(images)]]" restamp="true">
            <button class="dot"></button>
          </template>
        </iron-selector>
        </nav>
        <h6>[[_getCaption(images.*, currentItem)]]</h6>
      </footer>
    </section>

  </template>

  <script>
    Polymer({

      is: 'aleppo-content-slider',

      properties: {
        
        images: {
          type: Array
        },

        totalItems: {
          type: Number
        },

        currentItem: {
          type: Number
        },

        hideCaption: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        }

      },

      listeners: {
        'main.tap': '_toggleCaption'
      },

      _handleSelectDot: function(evt, data) {
        var selectedDot = this.$$('iron-selector').selected;
        this.$$('paper-carousel').goToItem(selectedDot);
      },

      _toggleCaption: function() {
        this.hideCaption = !this.hideCaption;
      },

      _getCaption: function(imagesChange, currentItem) {
        return this._objectToArray(imagesChange.base)[currentItem].description;
      },

      _objectToArray: function (images) {
        var imagesArray=[];
        for (image in images) {
          imagesArray.push(images[image])
        }
        return imagesArray;
      }
    });
  </script>
</dom-module>
