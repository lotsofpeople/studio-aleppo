<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../iron-selector/iron-selector.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="aleppo-dropdown-menu.html">

<!--
`aleppo-filter`


@demo demo/aleppo-filter.html
-->

<dom-module id="aleppo-filter">
  <template>
    <style>
      :host {
        display: block;
      }

      [hidden] {
        display: none!important;
      }

      section {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
      }

      .iron-selected {
        --paper-button: {
          background-color: blue
        }
      }
    </style>

    <iron-ajax
      url="[[apiEndpoint]]/wp-json/wp/v2/tags"
      auto="[[apiEndpoint]]"
      method="GET"
      handle-as="json"
      last-response="{{tagsData}}"
    ></iron-ajax>

    <main>
      <section>
        <aleppo-dropdown-menu items="[[cities]]" selected-item="{{studioLocation}}"></aleppo-dropdown-menu>
        <aleppo-dropdown-menu items="[[years]]" selected-item="{{migrationYear}}"></aleppo-dropdown-menu>
      </section>
      <section>
        <iron-selector attr-for-selected="tag-id" multi selected-values="{{activeTags}}">
          <template is="dom-repeat" items="[[tagsData]]">
            <paper-button tag-id="[[item.id]]">[[item.name]]</paper-button>
          </template>
        </iron-selector>
      </section>
    </main>
  </template>

  <script>
    Polymer({

      is: 'aleppo-filter',

      properties: {
        apiEndpoint: {
          type: String
        },

        tagsData: {
          type: Array
        },

        cities: {
          type: Array
        },
        
        years: {
          type: Array
        },        

        activeTags: {
          type: Array,
          notify: true
        },

        studioLocation: {
          type: String,
          notify: true
        },

        migrationYear: {
          type: String,
          notify: true
        }        
      },

      observers: [
        '_tagsDataChanged(tagsData.splices)'
      ],

      _tagsDataChanged: function(tagsDataSplice) {
        console.info('_tagsDataChanged!', JSON.stringify(this.tagsData));
      }

    });
  </script>
</dom-module>