<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../polymerfire/firebase-query.html">

<link rel="import" href="aleppo-citizen-grid.html">
<!--
`aleppo-personal-gallery`


@demo demo/aleppo-personal-gallery.html
-->

<dom-module id="aleppo-personal-gallery">
  <template>
    <style>
      :host {
        display: block;
      }

      [hidden] {
        display: none!important;
      }
    </style>

    <firebase-query
      path="/galleries/[[galleryId]]"
      data="{{galleryCitizenIds}}"
    ></firebase-query>

      <aleppo-citizen-grid
        citizens-data="[[galleryCitizensData]]"
        show-all-citizens-anonymous="[[!galleryReachedMinimumLength]]"
      ></aleppo-citizen-grid>
  
  </template>
  <script>
    Polymer({

      is: 'aleppo-personal-gallery',
      properties: {
        galleryId: {
          type: String
        },

        galleryCitizenIds: {
          type: Array,
          value: []
        },

        citizensData: {
          type: Array,
          value: []
        },

        galleryCitizensData: {
          type: Array,
          value: []
        },
        
        userGalleryLength: {
          type: Number,
          value: 0
        },

        galleryReachedMinimumLength: {
          type: Boolean,
          value: false,
          computed: "_computeGalleryReachedMinimumLength(userGalleryLength)"
        }


        

      },
      observers: [
        '_setGalleryCitizens(citizensData.*, galleryCitizenIds.*)',        
        '_setUserGalleryLength(userGallery.splices)',

      ],

      _setGalleryCitizens: function (allCitizensIdsSplices, galleryCitizenIdsChanged) {
        var galleryCitizenIds = this.galleryCitizenIds;
        var citizensData = this.citizensData;
        
        if(galleryCitizenIds.length > 0) this.set('galleryCitizensData', []);


        for(var i = 0; i < galleryCitizenIds.length; i++) {
          var index = citizensData.findIndex(x => x.id=== parseInt(galleryCitizenIds[i].$key));

          // Get Object of currentCitizen
          var currentCitizen = citizensData[index] || {};          

          this.push('galleryCitizensData', currentCitizen);
        }
      },

      _setUserGalleryLength: function (userGallerySplices) {
        var galleryLength = this.userGallery.length ? this.userGallery.length : 0;
        this.set('userGalleryLength', galleryLength);
      },

      _computeGalleryReachedMinimumLength: function (userGalleryLength) {
        return userGalleryLength > 4;
      }
      


    });
  </script>
</dom-module>